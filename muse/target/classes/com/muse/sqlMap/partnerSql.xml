<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="com.muse.partner.mapper.partnerSql">
  
  <select id="selectActorName"  resultType="com.muse.partner.model.ActorDTO" parameterType="String">
  	select * from musical_actor where ma_name = #{ma_name}
  </select>

	<select id="selectMusicalList" parameterType="map" resultType="com.muse.partner.model.MusicalDTO">
    SELECT * FROM musical
    WHERE pr_code = #{pr_code}
    <if test="seachMusical != null and seachMusical != ''">
    AND m_title LIKE '%' || #{seachMusical} || '%'
	</if>
</select>

<select id="selectStartEndDate"  resultType="com.muse.partner.model.MusicalDTO" parameterType="String">
  select m_startDate, m_endDate  from musical where m_code = #{m_code}
  </select>
  
<insert id="insetMuscialDate" parameterType="map">
insert into musical_option values('mo_'||MUSICAL_OPTION_MO_CODE.nextval,#{m_code},#{mo_date},#{mo_time})
</insert>

<select id="selectOptionList"  resultType="com.muse.partner.model.MusicalOptionDTO" parameterType="String">
  select distinct mo_date from musical_option where m_code = #{m_code} order by mo_date
  </select>
  
<select id="selectTimeOptionList" resultType="com.muse.partner.model.MusicalOptionDTO" parameterType="map">
	select mo_time from musical_option where m_code = #{m_code} and mo_date = #{mo_date} 
</select>

<insert id="insertCasting" parameterType="map">
insert into musical_casting values
('mc_'||MUSICAL_CASTING_MC_CODE.nextval,
#{ma_code},
(select mo_code 
from 
musical_option 
where mo_date = 
#{mo_date} and 
mo_time = #{mo_time} and 
m_code = #{m_code}),
#{mc_char})

</insert>
<insert id="insertTicketNotice" parameterType="map">
    insert into open_notice (
        on_code,
        m_code,
        rs_code,
        on_type,
        on_open,
        on_muse_open,
        on_info,
        on_sale,
        on_content,
        on_casting,
        on_img,
        on_etc,
        on_readnum,
        on_viewstate
    ) values (
        'on_' || OPEN_NOTICE_ON_CODE.nextval,
        #{m_code},
        #{rs_code},
        #{on_type},
        #{on_open},
        #{on_muse_open},
        #{on_info},
        #{on_sale},
        #{on_content},
        #{on_casting},
         (select m_detailimg from musical where m_code = #{m_code}),
        #{on_etc},
        0,
        0
    )
</insert>
<select id="selectMusicalHallList"  resultType="com.muse.partner.model.MusicalHallDTO">
	select * from musical_Hall
</select>

<select id="selectSeatGradeList" resultType="com.muse.partner.model.SeatGradeDTO">
	select * from seat_grade
</select>

<insert id="SelectSeatList" parameterType="com.muse.seat.model.SeatDTO">
    INSERT INTO SEAT (
            S_CODE, SG_CODE, M_CODE, MHL_CODE, 
            S_SECTION, S_POSITION, S_ROW, S_FLOOR
        ) 
        VALUES (
            seat_s_code.nextval,
            #{sg_code},
            #{m_code},
            #{mhl_code},
            #{s_section},
            #{s_position},
            #{s_row},
            #{s_floor}
        )
	</insert>
	
	
		<insert id="insertMusical" parameterType="com.muse.partner.model.MusicalDTO">
    INSERT INTO musical (
        M_CODE,
        MH_CODE,
        PR_CODE,
        M_TITLE,
        M_STARTDATE,
        M_ENDDATE,
        M_TIME,
        M_INTIME,
        M_MAXTICKET,
        M_AGE,
        M_OPENDATE,
        M_OPENTIME,
        M_NOTICE,
        M_POSTER,
        M_DETAILIMG,
        M_CALENDAR,
        M_SINGLE,
        M_VIEWSTATE,
        M_REF
    ) VALUES (
        'm_' || MUSICAL_M_CODE.NEXTVAL,  
        #{mh_code},
        #{pr_code}, 
        #{m_title},                     
        #{m_startDate},                  
        #{m_endDate},                    
        #{m_time},                       
        #{m_inTime},                     
        #{m_maxTicket},                  
        #{m_age},                        
        #{m_openDate},                   
        #{m_openTime},                   
        #{m_notice},                     
        #{m_poster},                     
        #{m_detailImg},                 
        #{m_calendar},                  
        #{m_single},                   
        0,                 
        0                       
    )

	</insert>
	
	<select id="selectPartner" resultType="com.muse.partner.model.PartnerDTO" parameterType="String">
	select * from partner where pr_code = #{pr_code}
	</select>
	
	<insert id="partnerInsert" parameterType="com.muse.partner.model.PartnerDTO">
		insert into partner values(
		'pr_'||PARTNER_PR_CODE.nextval,
		0,
		#{u_id},
		#{pr_name},
		#{pr_num},
		#{pr_pnum},
		#{pr_email}
		)

	</insert>
	<select id="reviewList" resultType="com.muse.partner.model.MusicalReviewDTO" parameterType="String">
	SELECT 
    r.MR_CODE, 
    r.MR_TITLE, 
    r.MR_CONTENT, 
    r.MR_SCORE, 
    r.MR_DATE,
    b.u_id
FROM 
    musical_review r
JOIN 
    booking b ON r.B_CODE = b.B_CODE
JOIN 
    musical_option mo ON b.MO_CODE = mo.MO_CODE
JOIN 
    musical m ON mo.M_CODE = m.M_CODE 
WHERE 
    m.pr_code = #{pr_code}
	</select>
	<select id="searchCode" parameterType="map" resultType="int">
  SELECT NVL(MAX(TO_NUMBER(REGEXP_SUBSTR(#{code}, 
  '[0-9]+$'))), 0) AS max_idx
  FROM #{table}
</select>
<insert id="insertservRe" parameterType="com.muse.partner.model.ServiceRequestDTO">
	INSERT INTO SERVICE_REQUEST ( 
        SR_CODE, RT_CODE, RS_CODE, M_CODE, RS_DATE, RS_ETC, RS_REASON
    ) 
    VALUES (
        'SR' || SERVICE_REQUEST_SR_CODE.NEXTVAL,
        #{rtCode},
        #{rsCode},
        #{mCode},
        sysdate,
        '0',
        '0'
    )
    </insert>
  </mapper>